<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunday Board - Project Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyACk3UhHouKfGsOu3ZJfaOhqLqucumn2UQ",
            authDomain: "sunday-fb28c.firebaseapp.com",
            databaseURL: "https://sunday-fb28c-default-rtdb.firebaseio.com",
            projectId: "sunday-fb28c",
            storageBucket: "sunday-fb28c.firebasestorage.app",
            messagingSenderId: "24752239756",
            appId: "1:24752239756:web:386c2c72624eb67ba337a9"
        };
        let firebaseApp, database;
        window.initFirebase = function() {
            if (typeof firebase !== 'undefined') {
                if (!firebase.apps.length) firebaseApp = firebase.initializeApp(firebaseConfig);
                else firebaseApp = firebase.apps[0];
                database = firebase.database();
                return true;
            }
            return false;
        };
        window.saveToFirebase = async (path, data) => { if (!database) return false; try { await database.ref(path).set(data); return true; } catch (e) { return false; } };
        window.loadFromFirebase = async (path) => { if (!database) return null; try { const snap = await database.ref(path).once('value'); return snap.val(); } catch (e) { return null; } };
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: #F6F7FB; font-size: 14px; color: #323338; }
        #root { width: 100%; min-height: 100vh; }
        button { font-family: inherit; cursor: pointer; }
        input, textarea { font-family: inherit; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"><div style="display:flex;align-items:center;justify-content:center;min-height:100vh;">Loading...</div></div>
    <script type="text/babel">
const { useState, useEffect } = React;

// ========== THEME ==========
const THEME = {
    dark: '#323338',
    gray: '#676879',
    lightGray: '#C5C7D0',
    border: '#E6E9EF',
    bg: '#F6F7FB',
    white: '#FFFFFF',
    primary: '#0073EA',
    purple: '#7B68EE',
    green: '#00C875',
    red: '#E2445C',
    yellow: '#FDAB3D',
};

// ========== AUTH PAGES ==========
const SignUpPage = ({ onSwitch, onSuccess }) => {
    const [form, setForm] = useState({ name: '', email: '', phone: '', password: '', confirm: '' });
    return (
        <div style={{ display: 'flex', minHeight: '100vh' }}>
            <div style={{ flex: 1, background: '#B8B8B8' }}></div>
            <div style={{ width: 500, background: THEME.white, padding: '60px 80px', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
                <div style={{ position: 'absolute', top: 20, right: 20 }}>
                    <span style={{ background: '#1B4D3E', color: 'white', padding: '4px 8px', borderRadius: 4, fontSize: 11 }}>EN</span>
                </div>
                <h1 style={{ fontSize: 28, fontWeight: 600, marginBottom: 8 }}>Sign up</h1>
                <p style={{ color: THEME.gray, marginBottom: 32, fontSize: 14 }}>Enter your information to create your account and get started.</p>

                <input type="text" placeholder="Full Name" value={form.name} onChange={e => setForm({...form, name: e.target.value})}
                    style={{ width: '100%', padding: '14px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, marginBottom: 16, fontSize: 14, outline: 'none' }} />
                <input type="email" placeholder="Email" value={form.email} onChange={e => setForm({...form, email: e.target.value})}
                    style={{ width: '100%', padding: '14px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, marginBottom: 16, fontSize: 14, outline: 'none' }} />
                <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                    <div style={{ display: 'flex', alignItems: 'center', padding: '0 12px', border: `1px solid ${THEME.border}`, borderRadius: 4, gap: 4 }}>
                        <span style={{ background: '#1B4D3E', color: 'white', padding: '2px 4px', borderRadius: 2, fontSize: 10 }}>SA</span>
                        <span style={{ color: THEME.gray }}>‚ñæ</span>
                    </div>
                    <input type="tel" placeholder="+966 123 4567 894" value={form.phone} onChange={e => setForm({...form, phone: e.target.value})}
                        style={{ flex: 1, padding: '14px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, fontSize: 14, outline: 'none' }} />
                </div>
                <div style={{ position: 'relative', marginBottom: 16 }}>
                    <input type="password" placeholder="********" value={form.password} onChange={e => setForm({...form, password: e.target.value})}
                        style={{ width: '100%', padding: '14px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, fontSize: 14, outline: 'none' }} />
                    <span style={{ position: 'absolute', right: 16, top: '50%', transform: 'translateY(-50%)', color: THEME.gray, cursor: 'pointer' }}>üëÅ</span>
                </div>
                <div style={{ position: 'relative', marginBottom: 32 }}>
                    <input type="password" placeholder="********" value={form.confirm} onChange={e => setForm({...form, confirm: e.target.value})}
                        style={{ width: '100%', padding: '14px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, fontSize: 14, outline: 'none' }} />
                    <span style={{ position: 'absolute', right: 16, top: '50%', transform: 'translateY(-50%)', color: THEME.gray, cursor: 'pointer' }}>üëÅ</span>
                </div>

                <button onClick={onSuccess} style={{ width: '100%', padding: '14px', background: THEME.dark, color: 'white', border: 'none', borderRadius: 4, fontSize: 15, fontWeight: 500, marginBottom: 24 }}>
                    Sign up
                </button>
                <p style={{ textAlign: 'center', fontSize: 14, color: THEME.gray }}>
                    Already have an account? <span onClick={onSwitch} style={{ color: THEME.dark, fontWeight: 600, cursor: 'pointer' }}>Login</span>
                </p>
            </div>
        </div>
    );
};

const LoginPage = ({ onSwitch, onSuccess }) => {
    const [form, setForm] = useState({ email: '', password: '', remember: false });
    return (
        <div style={{ display: 'flex', minHeight: '100vh' }}>
            <div style={{ flex: 1, background: '#B8B8B8' }}></div>
            <div style={{ width: 500, background: THEME.white, padding: '60px 80px', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
                <div style={{ position: 'absolute', top: 20, right: 20 }}>
                    <span style={{ background: '#1B4D3E', color: 'white', padding: '4px 8px', borderRadius: 4, fontSize: 11 }}>EN</span>
                </div>
                <h1 style={{ fontSize: 28, fontWeight: 600, marginBottom: 8 }}>Login</h1>
                <p style={{ color: THEME.gray, marginBottom: 32, fontSize: 14 }}>Enter your information to Login in your account.</p>

                <input type="email" placeholder="Email or phone" value={form.email} onChange={e => setForm({...form, email: e.target.value})}
                    style={{ width: '100%', padding: '14px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, marginBottom: 16, fontSize: 14, outline: 'none' }} />
                <div style={{ position: 'relative', marginBottom: 16 }}>
                    <input type="password" placeholder="********" value={form.password} onChange={e => setForm({...form, password: e.target.value})}
                        style={{ width: '100%', padding: '14px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, fontSize: 14, outline: 'none' }} />
                    <span style={{ position: 'absolute', right: 16, top: '50%', transform: 'translateY(-50%)', color: THEME.gray, cursor: 'pointer' }}>üëÅ</span>
                </div>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 32 }}>
                    <label style={{ display: 'flex', alignItems: 'center', gap: 8, fontSize: 14, color: THEME.gray, cursor: 'pointer' }}>
                        <input type="checkbox" checked={form.remember} onChange={e => setForm({...form, remember: e.target.checked})} />
                        Remember
                    </label>
                    <span style={{ fontSize: 14, color: THEME.gray, cursor: 'pointer' }}>Forget Password?</span>
                </div>

                <button onClick={onSuccess} style={{ width: '100%', padding: '14px', background: THEME.dark, color: 'white', border: 'none', borderRadius: 4, fontSize: 15, fontWeight: 500, marginBottom: 24 }}>
                    Login
                </button>
                <p style={{ textAlign: 'center', fontSize: 14, color: THEME.gray }}>
                    Don't have an account? <span onClick={onSwitch} style={{ color: THEME.dark, fontWeight: 600, cursor: 'pointer' }}>Sign up</span>
                </p>
            </div>
        </div>
    );
};

// ========== DASHBOARD ==========
const DashboardPage = ({ onBack, folders }) => {
    const stats = { all: 50, inProgress: 10, stuck: 4, done: 36 };
    const statusData = [
        { label: 'Working on it', value: 40, color: THEME.yellow },
        { label: 'Done', value: 40, color: THEME.green },
        { label: 'Stuck', value: 20, color: THEME.red },
    ];

    return (
        <div style={{ display: 'flex', minHeight: '100vh', background: THEME.bg }}>
            {/* Sidebar */}
            <div style={{ width: 240, background: THEME.white, borderRight: `1px solid ${THEME.border}`, display: 'flex', flexDirection: 'column' }}>
                <div style={{ padding: '16px 20px', background: '#292F4C' }}>
                    <span style={{ color: THEME.white, fontSize: 18, fontWeight: 600 }}>Logo</span>
                </div>
                <div style={{ padding: '12px 16px' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 10, padding: '10px 12px', background: '#E6F4FF', borderRadius: 4, marginBottom: 4 }}>
                        <span>üìä</span><span style={{ fontWeight: 500, color: THEME.primary }}>Dashboard and reporting</span>
                    </div>
                    <div onClick={onBack} style={{ display: 'flex', alignItems: 'center', gap: 10, padding: '10px 12px', borderRadius: 4, cursor: 'pointer' }}>
                        <span>‚òëÔ∏è</span><span>My work</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 10, padding: '10px 12px', borderRadius: 4 }}>
                        <span>‚òÜ</span><span>Favorites</span><span style={{ marginLeft: 'auto', color: THEME.gray }}>‚ñæ</span>
                    </div>
                </div>
                <div style={{ padding: '8px 16px', borderTop: `1px solid ${THEME.border}` }}>
                    <div style={{ fontSize: 12, color: THEME.gray, marginBottom: 8 }}>‚äû Workspaces ¬∑¬∑¬∑</div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '8px 12px', background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4 }}>
                        <span style={{ background: THEME.purple, color: 'white', padding: '2px 8px', borderRadius: 4, fontSize: 12 }}>W</span>
                        <span style={{ flex: 1 }}>Workspace</span>
                        <span style={{ color: THEME.gray }}>‚ñæ</span>
                        <button style={{ background: THEME.dark, color: 'white', border: 'none', borderRadius: 4, width: 24, height: 24 }}>+</button>
                    </div>
                </div>
                <div style={{ flex: 1, overflow: 'auto', padding: '8px 16px' }}>
                    {folders.map(f => (
                        <div key={f.id}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 6, padding: '6px 8px' }}>
                                <span style={{ fontSize: 8, color: THEME.gray }}>‚ñº</span>
                                <span>üìÅ</span><span style={{ fontSize: 14 }}>{f.name}</span>
                            </div>
                            {f.expanded && f.items.map(item => (
                                <div key={item.id} style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '6px 8px 6px 28px' }}>
                                    <span>{item.type === 'board' ? 'üìã' : 'üìÑ'}</span>
                                    <span style={{ fontSize: 14 }}>{item.name}</span>
                                </div>
                            ))}
                        </div>
                    ))}
                </div>
            </div>

            {/* Main Content */}
            <div style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>
                {/* Top Bar */}
                <div style={{ background: THEME.white, padding: '0 24px', height: 48, display: 'flex', alignItems: 'center', justifyContent: 'flex-end', gap: 16, borderBottom: `1px solid ${THEME.border}` }}>
                    <span>üîî</span><span>üë•</span><span>üîç</span>
                    <div style={{ width: 32, height: 32, borderRadius: '50%', background: THEME.lightGray }}></div>
                </div>

                {/* Dashboard Header */}
                <div style={{ background: THEME.white, padding: '16px 24px', borderBottom: `1px solid ${THEME.border}` }}>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 16 }}>
                        <h1 style={{ fontSize: 20, fontWeight: 600 }}>Dashboard and reporting</h1>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                            <span>üë§ Invite</span><span>‚ãÆ</span>
                        </div>
                    </div>
                    <div style={{ display: 'flex', gap: 12 }}>
                        <button style={{ padding: '8px 16px', background: THEME.primary, color: 'white', border: 'none', borderRadius: 4 }}>+ Add widget</button>
                        <button style={{ padding: '8px 16px', background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4 }}>1 Connected board</button>
                        <input placeholder="Type to search" style={{ padding: '8px 16px', border: `1px solid ${THEME.border}`, borderRadius: 4, width: 180 }} />
                        <button style={{ padding: '8px 16px', background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4 }}>üë• People</button>
                        <button style={{ padding: '8px 16px', background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4 }}>‚ñΩ Filter / All boarders</button>
                    </div>
                </div>

                {/* Dashboard Content */}
                <div style={{ flex: 1, overflow: 'auto', padding: 24 }}>
                    {/* Stats Cards */}
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 16, marginBottom: 24 }}>
                        <StatCard label="All Tasks" value={stats.all} color={THEME.primary} />
                        <StatCard label="In progress" value={stats.inProgress} color={THEME.yellow} />
                        <StatCard label="Stuck" value={stats.stuck} color={THEME.red} />
                        <StatCard label="Done" value={stats.done} color={THEME.green} />
                    </div>

                    {/* Charts Row */}
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16, marginBottom: 24 }}>
                        {/* Pie Chart - Tasks by status */}
                        <div style={{ background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 8, padding: 20 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 16 }}>
                                <span style={{ fontWeight: 600 }}>üìä Tasks by status</span>
                                <span style={{ color: THEME.gray }}>‚ãÆ</span>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 24 }}>
                                <PieChart data={statusData} />
                                <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>
                                    {statusData.map(d => (
                                        <div key={d.label} style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                            <div style={{ width: 12, height: 12, borderRadius: 2, background: d.color }}></div>
                                            <span style={{ fontSize: 13 }}>{d.label} {d.value}%</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Bar Chart - Tasks by owner */}
                        <div style={{ background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 8, padding: 20 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 16 }}>
                                <span style={{ fontWeight: 600 }}>üìä Tasks by owner</span>
                                <span style={{ color: THEME.gray }}>‚ãÆ</span>
                            </div>
                            <BarChart data={[
                                { label: 'NC', value: 15 },
                                { label: 'NC', value: 12 },
                                { label: 'NC', value: 18 },
                                { label: 'NC', value: 8 },
                                { label: 'NC', value: 10 },
                            ]} />
                        </div>
                    </div>

                    {/* Second Row */}
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>
                        {/* Overdue tasks */}
                        <div style={{ background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 8, padding: 20 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 16 }}>
                                <span style={{ fontWeight: 600 }}>‚ö†Ô∏è Overdue tasks</span>
                                <span style={{ color: THEME.gray }}>‚ãÆ</span>
                            </div>
                            <BarChart data={[
                                { label: 'Working on it', value: 25, color: THEME.yellow },
                                { label: 'Stuck', value: 8, color: THEME.red },
                            ]} horizontal />
                        </div>

                        {/* Tasks by due date */}
                        <div style={{ background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 8, padding: 20 }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 16 }}>
                                <span style={{ fontWeight: 600 }}>üìÖ Tasks by due date</span>
                                <span style={{ color: THEME.gray }}>‚ãÆ</span>
                            </div>
                            <BarChart data={[
                                { label: 'May 19, 25', values: [{ v: 12, c: THEME.yellow }, { v: 6, c: THEME.red }] },
                                { label: 'May 21, 25', values: [{ v: 10, c: THEME.yellow }, { v: 8, c: THEME.red }] },
                            ]} stacked />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
};

// Stat Card Component
const StatCard = ({ label, value, color }) => (
    <div style={{ background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 8, padding: 20, borderTop: `3px solid ${color}` }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>
            <span style={{ fontSize: 13, color: THEME.gray }}>{label}</span>
            <div style={{ display: 'flex', gap: 4 }}>
                <span style={{ fontSize: 10, padding: '2px 6px', background: '#F5F6F8', borderRadius: 4 }}>Sum ‚ñæ</span>
                <span style={{ color: THEME.gray }}>‚ãÆ</span>
            </div>
        </div>
        <div style={{ fontSize: 32, fontWeight: 700 }}>{value}</div>
    </div>
);

// Pie Chart Component
const PieChart = ({ data }) => {
    const total = data.reduce((a, d) => a + d.value, 0);
    let angle = 0;
    const segments = data.map(d => {
        const start = angle;
        angle += (d.value / total) * 360;
        return { ...d, start, end: angle };
    });

    return (
        <svg width="150" height="150" viewBox="0 0 100 100">
            {segments.map((s, i) => {
                const startRad = (s.start - 90) * Math.PI / 180;
                const endRad = (s.end - 90) * Math.PI / 180;
                const x1 = 50 + 40 * Math.cos(startRad);
                const y1 = 50 + 40 * Math.sin(startRad);
                const x2 = 50 + 40 * Math.cos(endRad);
                const y2 = 50 + 40 * Math.sin(endRad);
                const large = s.end - s.start > 180 ? 1 : 0;
                return (
                    <path key={i} d={`M50,50 L${x1},${y1} A40,40 0 ${large},1 ${x2},${y2} Z`} fill={s.color} />
                );
            })}
            <circle cx="50" cy="50" r="25" fill="white" />
        </svg>
    );
};

// Bar Chart Component
const BarChart = ({ data, horizontal, stacked }) => {
    const max = stacked
        ? Math.max(...data.map(d => d.values.reduce((a, v) => a + v.v, 0)))
        : Math.max(...data.map(d => d.value || 0));

    if (stacked) {
        return (
            <div style={{ display: 'flex', gap: 24, alignItems: 'flex-end', height: 120 }}>
                {data.map((d, i) => (
                    <div key={i} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 4 }}>
                        <div style={{ display: 'flex', flexDirection: 'column', height: 100 }}>
                            {d.values.map((v, j) => (
                                <div key={j} style={{ width: 40, height: (v.v / max) * 80, background: v.c }}></div>
                            ))}
                        </div>
                        <span style={{ fontSize: 11, color: THEME.gray }}>{d.label}</span>
                    </div>
                ))}
            </div>
        );
    }

    if (horizontal) {
        return (
            <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>
                {data.map((d, i) => (
                    <div key={i}>
                        <div style={{ fontSize: 12, marginBottom: 4 }}>{d.label}</div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                            <div style={{ height: 24, width: `${(d.value / max) * 100}%`, background: d.color || THEME.primary, borderRadius: 4 }}></div>
                            <span style={{ fontSize: 13 }}>{d.value}</span>
                        </div>
                    </div>
                ))}
            </div>
        );
    }

    return (
        <div style={{ display: 'flex', gap: 12, alignItems: 'flex-end', height: 120 }}>
            {data.map((d, i) => (
                <div key={i} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 4 }}>
                    <div style={{ width: 40, height: (d.value / max) * 80, background: THEME.primary, borderRadius: '4px 4px 0 0' }}></div>
                    <span style={{ fontSize: 10, color: THEME.gray }}>{d.label}</span>
                </div>
            ))}
        </div>
    );
};

// ========== INITIAL DATA ==========
const INITIAL_FOLDERS = [
    {
        id: 'f1', name: 'Name Folder', expanded: true,
        items: [
            { id: 'b1', name: 'Name board', type: 'board' },
            { id: 'b2', name: 'Name board', type: 'board' },
            { id: 'd1', name: 'Name document', type: 'document' },
        ]
    },
    {
        id: 'f2', name: 'Name Folder', expanded: true,
        items: [
            { id: 'b3', name: 'Name board', type: 'board' },
            { id: 'b4', name: 'Name board', type: 'board' },
            { id: 'd2', name: 'Name document', type: 'document' },
        ]
    },
    { id: 'f3', name: 'Name Folder', expanded: false, items: [] },
];

// Default columns configuration
const DEFAULT_COLUMNS = [
    { id: 'task', name: 'Task', width: 280, fixed: true },
    { id: 'creation', name: 'Creation', width: 120 },
    { id: 'person', name: 'Person', width: 120 },
    { id: 'status', name: 'Status', width: 140 },
    { id: 'date', name: 'Date', width: 120 },
];

const STATUS_OPTIONS = ['Working on it', 'Done', 'Stuck', 'Pending'];

const INITIAL_GROUPS = [
    {
        id: 'g1', title: 'Group title', collapsed: true,
        items: [
            { id: 'i1', name: 'Name item', creation: '19 May', person: 'NP', status: 'Working on it', date: '19 May', subitems: [
                { id: 's1', name: 'Subitem 1', creation: '19 May', person: 'NP', status: 'Done', date: '19 May', subsubitems: [
                    { id: 'ss1', name: 'Sub-subitem 1', creation: '19 May', person: 'NP', status: 'Pending', date: '19 May' },
                    { id: 'ss2', name: 'Sub-subitem 2', creation: '19 May', person: 'NP', status: 'Working on it', date: '19 May' },
                ]},
                { id: 's2', name: 'Subitem 2', creation: '19 May', person: 'NP', status: 'Stuck', date: '20 May', subsubitems: [] },
                { id: 's3', name: 'Subitem 3', creation: '19 May', person: 'NP', status: 'Working on it', date: '21 May', subsubitems: [] },
            ]},
            { id: 'i2', name: 'Name item', creation: '20 May', person: 'NP', status: 'Done', date: '22 May', subitems: [] },
        ]
    },
    {
        id: 'g2', title: 'Group title', collapsed: true,
        items: [
            { id: 'i3', name: 'Name item', creation: '19 May', person: 'NP', status: 'Working on it', date: '19 May', subitems: [
                { id: 's4', name: 'Subitem 1', creation: '19 May', person: 'NP', status: 'Done', date: '19 May', subsubitems: [] },
                { id: 's5', name: 'Subitem 2', creation: '19 May', person: 'NP', status: 'Pending', date: '20 May', subsubitems: [] },
                { id: 's6', name: 'Subitem 3', creation: '19 May', person: 'NP', status: 'Working on it', date: '21 May', subsubitems: [] },
            ]},
            { id: 'i4', name: 'Name item', creation: '20 May', person: 'NP', status: 'Stuck', date: '22 May', subitems: [] },
        ]
    },
    {
        id: 'g3', title: 'Group title', collapsed: false,
        items: [
            { id: 'i5', name: 'Name item', creation: '19 May', person: 'NP', status: 'Working on it', date: '19 May', subitems: [
                { id: 's7', name: 'Subitem 1', creation: '19 May', person: 'NP', status: 'Done', date: '19 May', subsubitems: [] },
                { id: 's8', name: 'Subitem 2', creation: '19 May', person: 'NP', status: 'Pending', date: '20 May', subsubitems: [] },
            ]},
            { id: 'i6', name: 'Name item', creation: '10 May', person: 'NP', status: 'Done', date: '15 May', subitems: [] },
        ]
    },
];

const INITIAL_UPDATES = [
    { id: 'u1', person: 'Person Name', time: '1d', breadcrumb: 'Board name > Item > Subitem', message: 'Message' },
    { id: 'u2', person: 'Person Name', time: '1d', breadcrumb: 'Board name > Item > Subitem', message: 'Message' },
];

// ========== MAIN APP ==========
const App = () => {
    const [currentPage, setCurrentPage] = useState('login'); // 'login', 'signup', 'board', 'dashboard'
    const [folders, setFolders] = useState(INITIAL_FOLDERS);
    const [groups, setGroups] = useState(INITIAL_GROUPS);
    const [updates, setUpdates] = useState(INITIAL_UPDATES);
    const [selectedBoard, setSelectedBoard] = useState('b1');
    const [showUpdates, setShowUpdates] = useState(true);
    const [activeTab, setActiveTab] = useState('Updates');
    const [isLoading, setIsLoading] = useState(true);
    const [columns, setColumns] = useState(DEFAULT_COLUMNS);
    const [draggedCol, setDraggedCol] = useState(null);

    // Auth pages
    if (currentPage === 'login') {
        return <LoginPage onSwitch={() => setCurrentPage('signup')} onSuccess={() => setCurrentPage('board')} />;
    }
    if (currentPage === 'signup') {
        return <SignUpPage onSwitch={() => setCurrentPage('login')} onSuccess={() => setCurrentPage('board')} />;
    }
    if (currentPage === 'dashboard') {
        return <DashboardPage onBack={() => setCurrentPage('board')} folders={folders} />;
    }

    useEffect(() => {
        const init = async () => {
            window.initFirebase && window.initFirebase();
            // Load data from API
            try {
                const res = await fetch('/api/monday/boards');
                const result = await res.json();
                if (result.success && result.data?.boards?.length > 0) {
                    const board = result.data.boards[0];
                    const mappedGroups = (board.groups || []).map(g => {
                        const items = (board.items_page?.items || [])
                            .filter(i => i.group?.id === g.id)
                            .map(i => ({
                                id: i.id,
                                name: i.name,
                                creation: '19 May',
                                subitems: (i.subitems || []).map(s => ({
                                    id: s.id,
                                    name: s.name,
                                    creation: '19 May',
                                    subsubitems: []
                                }))
                            }));
                        return { id: g.id, title: g.title, collapsed: false, items };
                    });
                    if (mappedGroups.length > 0) setGroups(mappedGroups);
                }
            } catch (e) { console.log('Using default data'); }
            setIsLoading(false);
        };
        init();
    }, []);

    const toggleFolder = (fId) => setFolders(f => f.map(x => x.id === fId ? {...x, expanded: !x.expanded} : x));
    const toggleGroup = (gId) => setGroups(g => g.map(x => x.id === gId ? {...x, collapsed: !x.collapsed} : x));

    const countSubitems = (items) => items.reduce((a, i) => a + (i.subitems?.length || 0), 0);
    const countSubsubitems = (items) => items.reduce((a, i) => a + (i.subitems || []).reduce((b, s) => b + (s.subsubitems?.length || 0), 0), 0);

    // Column drag handlers
    const handleDragStart = (e, colId) => {
        if (columns.find(c => c.id === colId)?.fixed) return;
        setDraggedCol(colId);
        e.dataTransfer.effectAllowed = 'move';
    };
    const handleDragOver = (e, colId) => {
        e.preventDefault();
        if (!draggedCol || draggedCol === colId || columns.find(c => c.id === colId)?.fixed) return;
    };
    const handleDrop = (e, targetColId) => {
        e.preventDefault();
        if (!draggedCol || draggedCol === targetColId) return;
        const dragIdx = columns.findIndex(c => c.id === draggedCol);
        const targetIdx = columns.findIndex(c => c.id === targetColId);
        if (dragIdx === -1 || targetIdx === -1) return;
        const newCols = [...columns];
        const [removed] = newCols.splice(dragIdx, 1);
        newCols.splice(targetIdx, 0, removed);
        setColumns(newCols);
        setDraggedCol(null);
    };
    const handleDragEnd = () => setDraggedCol(null);

    // Get grid template from columns
    const getGridTemplate = () => '40px ' + columns.map(c => c.width + 'px').join(' ') + ' 40px';

    if (isLoading) return <div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh',background:THEME.bg}}>Loading...</div>;

    return (
        <div style={{ display: 'flex', minHeight: '100vh', background: THEME.bg }}>
            {/* ===== SIDEBAR ===== */}
            <div style={{ width: 240, background: THEME.white, borderRight: `1px solid ${THEME.border}`, display: 'flex', flexDirection: 'column' }}>
                {/* Logo */}
                <div style={{ padding: '16px 20px', background: '#292F4C' }}>
                    <span style={{ color: THEME.white, fontSize: 18, fontWeight: 600 }}>Logo</span>
                </div>

                {/* Nav Items */}
                <div style={{ padding: '12px 16px' }}>
                    <div onClick={() => setCurrentPage('dashboard')} style={{ display: 'flex', alignItems: 'center', gap: 10, padding: '8px 10px', borderRadius: 4, cursor: 'pointer', fontSize: 14 }}>
                        <span>üìä</span><span>Dashboard and reporting</span>
                    </div>
                    <NavItem icon="‚òëÔ∏è" label="My work" />
                    <NavItem icon="‚òÜ" label="Favorites" expandable />
                </div>

                {/* Workspaces */}
                <div style={{ padding: '8px 16px', borderTop: `1px solid ${THEME.border}` }}>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 8 }}>
                        <span style={{ fontSize: 12, color: THEME.gray, display: 'flex', alignItems: 'center', gap: 6 }}>
                            <span>‚äû</span> Workspaces
                        </span>
                        <span style={{ color: THEME.gray, cursor: 'pointer' }}>¬∑¬∑¬∑</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '8px 12px', background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4, marginBottom: 12 }}>
                        <span style={{ background: THEME.purple, color: 'white', padding: '2px 8px', borderRadius: 4, fontSize: 12, fontWeight: 600 }}>W</span>
                        <span style={{ flex: 1, fontSize: 14 }}>Workspaces</span>
                        <span style={{ color: THEME.gray, fontSize: 10 }}>‚ñæ</span>
                        <button style={{ background: THEME.dark, color: 'white', border: 'none', borderRadius: 4, width: 24, height: 24, fontSize: 16 }}>+</button>
                    </div>
                </div>

                {/* Folder Tree */}
                <div style={{ flex: 1, overflow: 'auto', padding: '0 16px 16px' }}>
                    {folders.map(folder => (
                        <div key={folder.id} style={{ marginBottom: 4 }}>
                            <div onClick={() => toggleFolder(folder.id)} style={{ display: 'flex', alignItems: 'center', gap: 6, padding: '6px 8px', cursor: 'pointer', borderRadius: 4 }}>
                                <span style={{ color: THEME.gray, fontSize: 8, transform: folder.expanded ? 'rotate(0)' : 'rotate(-90deg)', transition: '0.2s' }}>‚ñº</span>
                                <span>üìÅ</span>
                                <span style={{ flex: 1, fontSize: 14, fontWeight: 500 }}>{folder.name}</span>
                                <span style={{ color: THEME.gray }}>‚ãÆ</span>
                            </div>
                            {folder.expanded && folder.items.map(item => (
                                <div key={item.id} onClick={() => setSelectedBoard(item.id)} style={{
                                    display: 'flex', alignItems: 'center', gap: 8, padding: '6px 8px 6px 28px', cursor: 'pointer', borderRadius: 4,
                                    background: selectedBoard === item.id ? '#E6F4FF' : 'transparent'
                                }}>
                                    <span>{item.type === 'board' ? 'üìã' : 'üìÑ'}</span>
                                    <span style={{ fontSize: 14, color: selectedBoard === item.id ? THEME.primary : THEME.dark }}>{item.name}</span>
                                </div>
                            ))}
                        </div>
                    ))}
                </div>
            </div>

            {/* ===== MAIN AREA ===== */}
            <div style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>
                {/* Top Bar */}
                <div style={{ background: THEME.white, borderBottom: `1px solid ${THEME.border}`, display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 24px', height: 48 }}>
                    <div></div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                        <span style={{ cursor: 'pointer' }}>üîî</span>
                        <span style={{ cursor: 'pointer' }}>üë•</span>
                        <span style={{ cursor: 'pointer' }}>üîç</span>
                        <div style={{ width: 32, height: 32, borderRadius: '50%', background: THEME.lightGray }}></div>
                    </div>
                </div>

                {/* Board Header */}
                <div style={{ background: THEME.white, padding: '16px 24px 0' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                        <h1 style={{ fontSize: 20, fontWeight: 600, margin: 0 }}>Name board</h1>
                        <span style={{ color: THEME.gray }}>‚ñæ</span>
                    </div>
                    <div style={{ display: 'flex', borderBottom: `1px solid ${THEME.border}` }}>
                        <Tab label="Main table" active />
                        <Tab label="Doc" />
                        <span style={{ padding: '12px 16px', color: THEME.lightGray, cursor: 'pointer' }}>+</span>
                    </div>
                </div>

                {/* Toolbar */}
                <div style={{ background: THEME.white, padding: '12px 24px', display: 'flex', alignItems: 'center', gap: 12, borderBottom: `1px solid ${THEME.border}` }}>
                    <button style={{ padding: '8px 16px', background: THEME.dark, color: 'white', border: 'none', borderRadius: 4, fontSize: 14, fontWeight: 500 }}>+ New item</button>
                    <div style={{ display: 'flex', alignItems: 'center', border: `1px solid ${THEME.border}`, borderRadius: 4, padding: '6px 12px', gap: 8, background: THEME.white }}>
                        <span style={{ color: THEME.gray }}>üîç</span>
                        <input type="text" placeholder="Search" style={{ border: 'none', outline: 'none', fontSize: 14, width: 100 }} />
                    </div>
                    <ToolbarBtn icon="üë•" label="People" />
                    <ToolbarBtn icon="‚ñΩ" label="Filter" />
                    <ToolbarBtn icon="‚Üï" label="Sort" />
                </div>

                {/* Content Area */}
                <div style={{ flex: 1, display: 'flex', overflow: 'hidden' }}>
                    {/* Groups */}
                    <div style={{ flex: 1, overflow: 'auto', padding: 24 }}>
                        {groups.map(group => {
                            const subCount = countSubitems(group.items);
                            const subsubCount = countSubsubitems(group.items);
                            return (
                                <div key={group.id} style={{ marginBottom: 16 }}>
                                    {/* Group Header */}
                                    <div onClick={() => toggleGroup(group.id)} style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '8px 0', cursor: 'pointer' }}>
                                        <span style={{ color: THEME.gray, fontSize: 10, transform: group.collapsed ? 'rotate(-90deg)' : 'rotate(0)', transition: '0.2s' }}>‚ñº</span>
                                        <span style={{ fontWeight: 600, color: THEME.dark }}>{group.title}</span>
                                        <span style={{ fontSize: 12, color: THEME.gray }}>
                                            {group.items.length} Items / {subCount} Subitems{subsubCount > 0 ? ` / ${subsubCount} Sub-subitems` : ''}
                                        </span>
                                    </div>

                                    {/* Table */}
                                    {!group.collapsed && (
                                        <div style={{ background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4, overflowX: 'auto' }}>
                                            {/* Table Header */}
                                            <div style={{ display: 'grid', gridTemplateColumns: getGridTemplate(), borderBottom: `1px solid ${THEME.border}`, fontSize: 12, color: THEME.gray, minWidth: 'fit-content' }}>
                                                <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                                    <input type="checkbox" />
                                                </div>
                                                {columns.map(col => (
                                                    <div
                                                        key={col.id}
                                                        draggable={!col.fixed}
                                                        onDragStart={(e) => handleDragStart(e, col.id)}
                                                        onDragOver={(e) => handleDragOver(e, col.id)}
                                                        onDrop={(e) => handleDrop(e, col.id)}
                                                        onDragEnd={handleDragEnd}
                                                        style={{
                                                            padding: '8px 12px',
                                                            textAlign: col.id === 'task' ? 'left' : 'center',
                                                            cursor: col.fixed ? 'default' : 'grab',
                                                            background: draggedCol === col.id ? '#E6F4FF' : 'transparent',
                                                            borderLeft: col.id !== 'task' ? `1px dashed ${THEME.border}` : 'none',
                                                            borderRight: `1px dashed ${THEME.border}`,
                                                            userSelect: 'none',
                                                            position: 'relative'
                                                        }}
                                                    >
                                                        {col.name}
                                                        {!col.fixed && <span style={{ position: 'absolute', left: 4, top: '50%', transform: 'translateY(-50%)', opacity: 0.3 }}>‚ãÆ‚ãÆ</span>}
                                                    </div>
                                                ))}
                                                <div style={{ padding: 8, textAlign: 'center', color: THEME.gray }}>+</div>
                                            </div>

                                            {/* Items */}
                                            {group.items.map((item, idx) => (
                                                <ItemRow
                                                    key={item.id}
                                                    item={item}
                                                    columns={columns}
                                                    gridTemplate={getGridTemplate()}
                                                    groupId={group.id}
                                                    index={idx}
                                                    onReorder={(fromIdx, toIdx) => {
                                                        setGroups(gs => gs.map(g => {
                                                            if (g.id !== group.id) return g;
                                                            const items = [...g.items];
                                                            const [moved] = items.splice(fromIdx, 1);
                                                            items.splice(toIdx, 0, moved);
                                                            return { ...g, items };
                                                        }));
                                                    }}
                                                />
                                            ))}

                                            {/* Add Task */}
                                            <div style={{ padding: '8px 12px 8px 52px', borderTop: `1px solid ${THEME.border}` }}>
                                                <span style={{ color: THEME.gray, fontSize: 13, cursor: 'pointer' }}>+ Add task</span>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}

                        {/* Add Group Button */}
                        <button style={{ display: 'flex', alignItems: 'center', gap: 8, padding: '12px 20px', background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4, fontSize: 14, color: THEME.dark }}>
                            + Add new group
                        </button>
                    </div>

                    {/* ===== UPDATES PANEL ===== */}
                    {showUpdates && (
                        <div style={{ width: 360, background: THEME.white, borderLeft: `1px solid ${THEME.border}`, display: 'flex', flexDirection: 'column' }}>
                            {/* Header */}
                            <div style={{ padding: '16px 20px', borderBottom: `1px solid ${THEME.border}`, display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                                <h3 style={{ fontSize: 16, fontWeight: 600, margin: 0 }}>Board Name Updates</h3>
                                <span onClick={() => setShowUpdates(false)} style={{ cursor: 'pointer', fontSize: 20, color: THEME.gray }}>√ó</span>
                            </div>

                            {/* Tabs */}
                            <div style={{ display: 'flex', borderBottom: `1px solid ${THEME.border}` }}>
                                {['Activity', 'Last viewed', 'Updates'].map(tab => (
                                    <button key={tab} onClick={() => setActiveTab(tab)} style={{
                                        flex: 1, padding: '12px', background: 'none', border: 'none',
                                        borderBottom: activeTab === tab ? '2px solid #323338' : '2px solid transparent',
                                        color: activeTab === tab ? THEME.dark : THEME.gray, fontSize: 13, fontWeight: 500
                                    }}>{tab}</button>
                                ))}
                            </div>

                            {/* Updates List */}
                            <div style={{ flex: 1, overflow: 'auto', padding: 16 }}>
                                {updates.map(update => (
                                    <UpdateCard key={update.id} update={update} />
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
};

// ========== COMPONENTS ==========
const NavItem = ({ icon, label, expandable }) => (
    <div style={{ display: 'flex', alignItems: 'center', gap: 10, padding: '8px 10px', borderRadius: 4, cursor: 'pointer', fontSize: 14 }}>
        <span>{icon}</span>
        <span style={{ flex: 1 }}>{label}</span>
        {expandable && <span style={{ color: THEME.gray, fontSize: 10 }}>‚ñæ</span>}
    </div>
);

const Tab = ({ label, active }) => (
    <button style={{
        padding: '12px 16px', background: 'none', border: 'none',
        borderBottom: active ? '2px solid #323338' : '2px solid transparent',
        color: active ? THEME.dark : THEME.gray, fontSize: 14, fontWeight: active ? 500 : 400, marginBottom: -1
    }}>{label}</button>
);

const ToolbarBtn = ({ icon, label }) => (
    <button style={{ display: 'flex', alignItems: 'center', gap: 6, padding: '6px 10px', background: 'none', border: 'none', fontSize: 13, color: THEME.gray }}>
        <span>{icon}</span><span>{label}</span>
    </button>
);

const ItemRow = ({ item, columns, gridTemplate, groupId, index, onReorder }) => {
    const [expanded, setExpanded] = useState(false);
    const [hovered, setHovered] = useState(false);
    const [isDragging, setIsDragging] = useState(false);
    const hasSubitems = item.subitems && item.subitems.length > 0;

    const handleRowDragStart = (e) => {
        setIsDragging(true);
        e.dataTransfer.setData('rowIndex', index.toString());
        e.dataTransfer.setData('groupId', groupId);
        e.dataTransfer.effectAllowed = 'move';
    };
    const handleRowDragOver = (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
    };
    const handleRowDrop = (e) => {
        e.preventDefault();
        const fromIdx = parseInt(e.dataTransfer.getData('rowIndex'));
        const fromGroup = e.dataTransfer.getData('groupId');
        if (fromGroup === groupId && fromIdx !== index) {
            onReorder(fromIdx, index);
        }
    };
    const handleRowDragEnd = () => setIsDragging(false);

    const renderCell = (col) => {
        switch (col.id) {
            case 'task':
                return (
                    <div style={{ padding: '8px 12px', display: 'flex', alignItems: 'center', gap: 8 }}>
                        <span onClick={() => hasSubitems && setExpanded(!expanded)} style={{ color: THEME.gray, fontSize: 10, cursor: hasSubitems ? 'pointer' : 'default' }}>
                            {hasSubitems ? (expanded ? '‚ñΩ' : '‚ñ∑') : '‚ñ∑'}
                        </span>
                        <span style={{ fontSize: 14 }}>{item.name}</span>
                        {hovered && (
                            <>
                                <span style={{ color: THEME.gray, cursor: 'pointer' }}>‚ãÆ</span>
                                <span style={{ color: THEME.gray, cursor: 'pointer', border: `1px solid ${THEME.border}`, borderRadius: 2, padding: '0 4px', fontSize: 12 }}>‚äï</span>
                            </>
                        )}
                    </div>
                );
            case 'creation':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 6 }}>
                        <span style={{ background: THEME.purple, color: 'white', padding: '2px 6px', borderRadius: 10, fontSize: 10, fontWeight: 500 }}>NP</span>
                        <span style={{ fontSize: 13 }}>{item.creation}</span>
                    </div>
                );
            case 'person':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <span style={{ background: THEME.purple, color: 'white', padding: '4px 10px', borderRadius: 12, fontSize: 11, fontWeight: 500 }}>{item.person || 'NP'}</span>
                    </div>
                );
            case 'status':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <span style={{ fontSize: 13, color: THEME.dark }}>{item.status || 'Working on it'}</span>
                    </div>
                );
            case 'date':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4 }}>
                        <span style={{ fontSize: 12 }}>‚è±</span>
                        <span style={{ fontSize: 13 }}>{item.date}</span>
                    </div>
                );
            default:
                return <div style={{ padding: 8 }}></div>;
        }
    };

    return (
        <>
            <div
                draggable
                onDragStart={handleRowDragStart}
                onDragOver={handleRowDragOver}
                onDrop={handleRowDrop}
                onDragEnd={handleRowDragEnd}
                style={{
                    display: 'grid',
                    gridTemplateColumns: gridTemplate,
                    borderBottom: `1px solid ${THEME.border}`,
                    background: isDragging ? '#E6F4FF' : hovered ? '#F5F6F8' : 'white',
                    cursor: 'grab',
                    opacity: isDragging ? 0.5 : 1,
                    minWidth: 'fit-content'
                }}
                onMouseEnter={() => setHovered(true)}
                onMouseLeave={() => setHovered(false)}
            >
                <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                    <input type="checkbox" onClick={(e) => e.stopPropagation()} />
                </div>
                {columns.map(col => (
                    <div key={col.id} style={{ borderLeft: col.id !== 'task' ? `1px dashed ${THEME.border}` : 'none' }}>
                        {renderCell(col)}
                    </div>
                ))}
                <div style={{ padding: 8 }}></div>
            </div>

            {/* Subitems */}
            {expanded && hasSubitems && (
                <div style={{ background: '#F5F6F8', position: 'relative' }}>
                    {/* Main tree line */}
                    <div style={{ position: 'absolute', left: 60, top: 0, bottom: 40, width: 2, background: '#C5C7D0' }}></div>
                    {item.subitems.map((sub, idx) => (
                        <SubitemRow key={sub.id} subitem={sub} columns={columns} gridTemplate={gridTemplate} isLast={idx === item.subitems.length - 1} />
                    ))}
                    <div style={{ padding: '8px 12px 8px 72px' }}>
                        <span style={{ color: THEME.gray, fontSize: 12, cursor: 'pointer' }}>+ Add task</span>
                    </div>
                </div>
            )}
        </>
    );
};

const SubitemRow = ({ subitem, columns, gridTemplate, isLast = false }) => {
    const [expanded, setExpanded] = useState(false);
    const [hovered, setHovered] = useState(false);
    const hasSubs = subitem.subsubitems && subitem.subsubitems.length > 0;

    const renderCell = (col, item, depth = 1, isLastItem = false) => {
        const fontSize = depth > 1 ? 11 : 12;
        const indent = depth * 24;

        switch (col.id) {
            case 'task':
                return (
                    <div style={{ padding: '8px 12px', display: 'flex', alignItems: 'center', gap: 8, position: 'relative' }}>
                        {/* Tree Lines */}
                        <div style={{ position: 'absolute', left: indent - 16, top: 0, bottom: isLastItem ? '50%' : 0, width: 2, background: '#C5C7D0' }}></div>
                        <div style={{ position: 'absolute', left: indent - 16, top: '50%', width: 12, height: 2, background: '#C5C7D0' }}></div>
                        <div style={{ width: indent }}></div>
                        {depth === 1 && <span onClick={() => hasSubs && setExpanded(!expanded)} style={{ color: THEME.gray, fontSize: 10, cursor: hasSubs ? 'pointer' : 'default' }}>
                            {hasSubs ? (expanded ? '‚ñΩ' : '‚ñ∑') : '‚ñ∑'}
                        </span>}
                        {depth > 1 && <span style={{ color: THEME.gray, fontSize: 10 }}>‚ñ∑</span>}
                        <span style={{ fontSize: fontSize + 1 }}>{item.name}</span>
                        {hovered && depth === 1 && <span style={{ color: THEME.gray, cursor: 'pointer' }}>‚ãÆ</span>}
                    </div>
                );
            case 'creation':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4 }}>
                        <span style={{ background: THEME.purple, color: 'white', padding: '2px 6px', borderRadius: 10, fontSize: 10, fontWeight: 500 }}>NP</span>
                        <span style={{ fontSize }}>{item.creation}</span>
                    </div>
                );
            case 'person':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <span style={{ background: THEME.purple, color: 'white', padding: '2px 6px', borderRadius: 10, fontSize: 10 }}>{item.person || 'NP'}</span>
                    </div>
                );
            case 'status':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <span style={{ fontSize }}>{item.status || 'Pending'}</span>
                    </div>
                );
            case 'date':
                return (
                    <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4 }}>
                        <span style={{ fontSize: 10 }}>‚è±</span>
                        <span style={{ fontSize }}>{item.date}</span>
                    </div>
                );
            default:
                return <div style={{ padding: 8 }}></div>;
        }
    };

    return (
        <>
            <div
                style={{ display: 'grid', gridTemplateColumns: gridTemplate, borderBottom: `1px solid ${THEME.border}`, background: hovered ? '#ECEDF0' : '#F5F6F8', minWidth: 'fit-content' }}
                onMouseEnter={() => setHovered(true)}
                onMouseLeave={() => setHovered(false)}
            >
                <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                    <input type="checkbox" />
                </div>
                {columns.map(col => (
                    <div key={col.id} style={{ borderLeft: col.id !== 'task' ? `1px dashed ${THEME.border}` : 'none' }}>
                        {renderCell(col, subitem, 1, isLast)}
                    </div>
                ))}
                <div style={{ padding: 8 }}></div>
            </div>

            {/* Sub-subitems */}
            {expanded && hasSubs && (
                <div style={{ background: '#EAEBEE' }}>
                    {subitem.subsubitems.map((ss, idx) => (
                        <div key={ss.id} style={{ display: 'grid', gridTemplateColumns: gridTemplate, borderBottom: `1px solid ${THEME.border}`, minWidth: 'fit-content' }}>
                            <div style={{ padding: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                <input type="checkbox" />
                            </div>
                            {columns.map(col => (
                                <div key={col.id} style={{ borderLeft: col.id !== 'task' ? `1px dashed ${THEME.border}` : 'none' }}>
                                    {renderCell(col, ss, 2, idx === subitem.subsubitems.length - 1)}
                                </div>
                            ))}
                            <div style={{ padding: 8 }}></div>
                        </div>
                    ))}
                </div>
            )}
        </>
    );
};

const UpdateCard = ({ update }) => {
    const [showMenu, setShowMenu] = useState(false);
    return (
        <div style={{ background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 8, padding: 16, marginBottom: 12, position: 'relative' }}>
            {/* Header */}
            <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 8 }}>
                <span style={{ background: THEME.purple, color: 'white', padding: '4px 8px', borderRadius: 12, fontSize: 11, fontWeight: 500 }}>NP</span>
                <span style={{ fontWeight: 600, fontSize: 14 }}>{update.person}</span>
                <span style={{ color: THEME.gray, fontSize: 12 }}>{update.time}</span>
                <div style={{ marginLeft: 'auto', position: 'relative' }}>
                    <span onClick={() => setShowMenu(!showMenu)} style={{ cursor: 'pointer', color: THEME.gray }}>‚ãÆ</span>
                    {showMenu && (
                        <div style={{ position: 'absolute', top: 20, right: 0, background: THEME.white, border: `1px solid ${THEME.border}`, borderRadius: 4, boxShadow: '0 2px 8px rgba(0,0,0,0.1)', zIndex: 10 }}>
                            <div style={{ padding: '8px 16px', cursor: 'pointer', whiteSpace: 'nowrap' }}>‚úèÔ∏è Edit update</div>
                            <div style={{ padding: '8px 16px', cursor: 'pointer', whiteSpace: 'nowrap' }}>üîó Copy link to update</div>
                            <div style={{ padding: '8px 16px', cursor: 'pointer', whiteSpace: 'nowrap' }}>üóëÔ∏è Delete update</div>
                        </div>
                    )}
                </div>
            </div>
            {/* Breadcrumb */}
            <div style={{ fontSize: 12, color: THEME.gray, marginBottom: 8, display: 'flex', alignItems: 'center', gap: 4 }}>
                <span>üìã</span> {update.breadcrumb}
            </div>
            {/* Message */}
            <div style={{ fontSize: 14, marginBottom: 12 }}>{update.message}</div>
            {/* Actions */}
            <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 12 }}>
                <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 13, color: THEME.gray, cursor: 'pointer' }}>üëç Like</span>
                <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 13, color: THEME.gray, cursor: 'pointer' }}>‚Ü©Ô∏è Reply</span>
                <span style={{ marginLeft: 'auto', cursor: 'pointer' }}>üëÅÔ∏è</span>
            </div>
            {/* Reply Input */}
            <div style={{ display: 'flex', alignItems: 'center', gap: 8, padding: 12, background: '#F5F6F8', borderRadius: 4 }}>
                <span style={{ background: THEME.purple, color: 'white', padding: '4px 8px', borderRadius: 12, fontSize: 11 }}>NP</span>
                <input type="text" placeholder="Write a reply and mention others with @" style={{ flex: 1, border: 'none', background: 'transparent', outline: 'none', fontSize: 13 }} />
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginTop: 8 }}>
                <span style={{ fontSize: 12, color: THEME.gray, cursor: 'pointer' }}>@ Mention</span>
                <span style={{ fontSize: 12, color: THEME.gray, cursor: 'pointer' }}>üìé</span>
                <span style={{ fontSize: 12, color: THEME.gray, cursor: 'pointer' }}>GIF</span>
                <span style={{ fontSize: 12, color: THEME.gray, cursor: 'pointer' }}>üòä</span>
                <button style={{ marginLeft: 'auto', padding: '6px 16px', background: THEME.primary, color: 'white', border: 'none', borderRadius: 4, fontSize: 13 }}>Reply ‚ñæ</button>
            </div>
        </div>
    );
};

// ========== RENDER ==========
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
